Non-analogues in paleoecological reconstruction - the effects of analogue distance
========================================================

**Abstract**
Some jibberish.

```{r}
library(gridExtra)

source('R/data_setup.R')

```

Introduction
=========================
Pollen assemblages are widely used for paleoclimatic reconstruction during the Holocene, but this method is also applied to pollen assemblages from the last Glacial period (Bartlein et al., 2011), as well as to earlier pollen assemblages, such as those during the Eemian (Brewer et al, 2008).  A particular challenge for climate reconstruction using these much earlier samples is the presence of non-analogue vegetation.  Non-analogue pollen assemblages pose a problem for many reconstruction techniques, these vegetation assemblages may be the result of sets of climate variables that no longer co-exist, ecological conditions resulting from differing rates of species migration or release from herbivores (Gill et al., 2009?), or as a result of changes in human land use (St. Jacques?, maybe not the best. . .).  

Predicting climate from pollen in non-analogue space is likely to increase the uncertainty of models, possibly introduce systematic bias in predictions, and is likely to increase the variability of predictions across a time-series of predictions from a single site. However, high-quality terrestrial proxies for climate are important for understanding past climate change, and can act as a constraint on models of climate change in the past derived from GCMs in regions where little proxy data is available.  Thus, understanding the behaviour of pollen-based climate reconstructions in non-analogue space is an important first stem in understanding these reconstructions.

Although we cannot know the values for temperature or 

Methods:
=========================

Sites from across North America were used to build a modern analogue dataset.

```{r SiteLocations, fig.width=7, fig.height=6, fig.cap='Figure: North American site locations'}
map <- map_data('world')

map <- subset(map, map$long > -170 & map$long < -30)
map <- subset(map, map$lat > 20 & map$lat < 83)

ggplot(data = data.frame(map), aes(long, lat)) + 
  geom_polygon(aes(group=group), color='blue', alpha=0.2) +
  geom_point(data = data.frame(climate), aes(x = LONDD, y = LATDD), alpha = 0.5) +
  theme_bw() +
  xlab('') + ylab('') +
  theme(axis.text=element_text(size=12, family='serif')) +
  coord_map(projection='albers', lat0=30, lat1=50, xlim=c(-145, -60), ylim=c(26, 75))

```
**Figure 1**. Location of sample plots used for analysis.  Samples are derived from a modern pollen dataset.


Results
=========================

When we examine the dissimilarity scores we can see that the distribution between minimum, maximum and overall dissimilarities can be understood numerically and spatially.

```{r MinMaxDissim, fig.width=7, fig.height=6, fig.cap='Figure: North American site locations'}

dissim.scores <- data.frame(dissim = c(min.diss, 
                                       max.diss, 
                                       as.vector(dists)[sample(length(dists), 10000)]),
                            class   = c(rep('Minimum', length(min.diss)),
                                        rep('Maximim', length(max.diss)), 
                                        rep('All', 10000)))
              
ggplot(dissim.scores) + 
  geom_density(aes(x = dissim, fill=class), alpha=0.5) +
  theme_bw() +
  xlab('Squared-chord Dissimilarity') +
  ylab('Density') +
  theme(text = element_text(size=24, family='serif'),
        strip.text = element_text(size=14, family='serif'),
        axis.text = element_text(size = 12, family='serif')) +
  annotate("segment", x=0.48, xend = -.32, y = 0, yend = 1, size=3, color='red') +
  scale_x_log10() + scale_y_sqrt()

```
**Figure X**.  *Distribution of squared-chord dissimilarity values.  The 95% confidence interval for the minumum spanning distance in the North American Modern Pollen Database is 0.10 - 0.48.  We choose 0.48 as our cut-off for 'non-analogue' distances in the database.*

```{r SiteMDS, fig.width=7, fig.height=6, fig.cap='Figure: North American site MDS scores'}

mds <- data.frame(pol.mds$points,
                  non.ana = factor(min.diss > 0.48))

non.ana <- ggplot(data = mds, aes(x = X1, y = X2)) +
  geom_point(data = mds[mds$non.ana == FALSE,], alpha=0.5, size = 2, color='black') +   
  geom_point(data = mds[mds$non.ana == TRUE,], alpha=0.7, size = 4, color='red') +
  theme_bw() +
  xlab('MDS Axis One') + ylab('MDS Axis Two') +
  theme(text = element_text(size=24, family='serif'))

non.ana.map <- ggplot(data = data.frame(map), aes(long, lat)) + 
  geom_path(aes(group=group), color='black') +
  geom_point(data = data.frame(climate)[mds$non.ana == FALSE,], 
             aes(x = LONDD, y = LATDD), alpha=0.5) +
  geom_point(data = data.frame(climate)[mds$non.ana == TRUE,], 
             aes(x = LONDD, y = LATDD), color = 'red') +
   theme_bw() +
  coord_map(projection='albers', lat0=30, lat1=50, xlim=c(-140, -60), ylim=c(26, 75))

grid.arrange(non.ana, non.ana.map, ncol=2)

```
**Figure 2**. *Location of non-analogue points in the modern pollen data, presented within a non-metric multidimensional scaling ordination (Panel 1) and geographically.  Interestingly, although a number of geographically isolated points exist in the dataset, the majority of non-analogue points exist within the most dense region of sampling, indicating that non-analogue sites are not ecologically stratified.*

Model outputs
=========================
```{r LoadOutputs, echo=FALSE, message=FALSE, warning=FALSE}
load('data/wa.res.RData')
load('data/mat.res.RData')
load('data/wapls.res.RData')

vals <- c(seq(0, 0.2, by=0.001), seq(0.21, 1, by=0.01))

na.samples <- data.frame(size = as.vector(wa.res$sample_size),
                         distance = rep(vals, each = nrow(wa.res$sample_size)),
                         alpha.val = rep(diff(c(-.5,vals)), each = nrow(wa.res$sample_size))+0.005)

na.samples <- na.samples[!is.na(na.samples$size),]

ggplot(na.samples, aes(x=distance, y=size)) + geom_point(aes(alpha=alpha.val)) +
  xlab('Analogue Distance') + ylab('Available Samples') +
  theme(text = element_text(size=24, family='serif')) +
  theme_bw() +
  scale_alpha_identity(guide='none')

```
**Figure X**. *As the analogue distance exclusion is increased the available data set size is reduced, although some points continue to maintain a large number of potential analogues, this is directly related to the minimum distance to the closest analogue.  Points that maintain a large pool of analogues are far from neighbours.*

```{r PredictedValues, message=FALSE, echo=FALSE, warning=FALSE}

load('data/mat.res.RData')
load('data/wa.res.RData')
load('data/wapls.res.RData')


model.out <- data.frame(site   = rep(rep(climate[,1], ncol(mat.res$bias)),3),
                        preds  = c(as.vector(mat.res$mean_prediction),
                                   as.vector(wa.res$mean_prediction),
                                   as.vector(wapls.res$mean_prediction)),
                        dissim = rep(rep(vals, each=nrow(mat.res$bias)),3),
                        model  = rep(c('MAT', 'WA', 'WAPLS'), each = length(mat.res$bias)))


model.out <- model.out[!colSums(is.na(model.out)) > 0,]

ggplot(model.out, aes(x = dissim, y = preds, group = site)) +
  geom_path(alpha = 0.01) +
  theme_bw() +
  facet_wrap(~mode)
  scale_x_continuous(expand=c(0,0)) +
  annotate('segment', x=0, xend=1, 
           y=mean(climate[,10], na.rm=TRUE),
           yend=mean(climate[,10], na.rm=TRUE),
           color='red', size=1.5, linetype=2)

```
**Figure X**.

References
=========================
Bartlein, P. J., Harrison, S. P., Brewer, S., Connor, S., Davis, B. A. S., Gajewski, K., ... & Wu, H. (2011). Pollen-based continental climate reconstructions at 6 and 21 ka: a global synthesis. Climate Dynamics, 37(3-4), 775-802.
Brewer, S., Guiot, J., Sánchez-Goñi, M. F., & Klotz, S. (2008). The climate in Europe during the Eemian: a multi-method approach using pollen data. Quaternary Science Reviews, 27(25), 2303-2315.